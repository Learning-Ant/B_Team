<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.koreait.baraON.dao.PlaceDao">
	
	<select id="placeList" resultType="com.koreait.baraON.dto.PlaceListDto" >
		SELECT A.P_NO, A.RVCOUNT, PC.PC_NAME, MIN(PO.PO_DAYPRICE) AS MINPRICE, MAX(PO.PO_MAX) AS MAXPEOPLE, P2.P_TITLE, P2.P_IMG, P2.P_ADDR
		  FROM (SELECT P.P_NO, P.PC_NO, COUNT(RV.P_NO) AS RVCOUNT
				  FROM PLACE P LEFT JOIN REVIEW RV ON P.P_NO = RV.P_NO
				 WHERE P.P_CONFIRM = 1 
				   AND P.P_DELETE = 0
				   AND RV.RV_DELETE = 0
			  GROUP BY P.P_NO, P.PC_NO) A LEFT JOIN PLACECATEGORY PC ON A.PC_NO = PC.PC_NO
										  LEFT JOIN PLACEOPTION PO ON A.P_NO = PO.P_NO
										  LEFT JOIN PLACE P2 ON A.P_NO = P2.P_NO
	  GROUP BY A.P_NO, A.PC_NO, A.RVCOUNT, PC.PC_NAME, P2.P_TITLE, P2.P_IMG, P2.P_ADDR
	  ORDER BY A.P_NO
	</select>
	
	
	
	
</mapper>