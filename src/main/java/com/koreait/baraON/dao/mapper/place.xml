<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.koreait.baraON.dao.PlaceDao">
	
	<select id="placeList" resultType="com.koreait.baraON.dto.PlaceListDto" >
		SELECT A.P_NO, A.RVCOUNT, PC.PC_NAME, MIN(PO.PO_DAYPRICE) AS MINPRICE, MAX(PO.PO_MAX) AS MAXPEOPLE, P2.P_TITLE, P2.P_IMG, P2.P_ADDR
		  FROM (SELECT P.P_NO, P.PC_NO, COUNT(RV.P_NO) AS RVCOUNT
				  FROM PLACE P LEFT JOIN REVIEW RV ON P.P_NO = RV.P_NO
				 WHERE P.P_CONFIRM = 1 
				   AND P.P_DELETE = 0
				   AND RV.RV_DELETE = 0
			  GROUP BY P.P_NO, P.PC_NO) A LEFT JOIN PLACECATEGORY PC ON A.PC_NO = PC.PC_NO
										  LEFT JOIN PLACEOPTION PO ON A.P_NO = PO.P_NO
										  LEFT JOIN PLACE P2 ON A.P_NO = P2.P_NO
	  GROUP BY A.P_NO, A.PC_NO, A.RVCOUNT, PC.PC_NAME, P2.P_TITLE, P2.P_IMG, P2.P_ADDR
	  ORDER BY A.P_NO
	</select>
	
	<select id="getPlaceDto" parameterType="int" resultType="com.koreait.baraON.dto.PlaceDto" >
		SELECT *
		FROM PLACE
		WHERE P_NO=#{param1}
	</select>
	<select id="getPcName" parameterType="int" resultType="string" >
		SELECT PC_NAME
		FROM PLACECATEGORY
		WHERE PC_NO = #{param1}
	</select>
	
	<select id="getSellerDto" parameterType="int" resultType="com.koreait.baraON.dto.SellerDto" >
		SELECT S_NO, S_ID, S_PHONE, S_NAME, S_EMAIL, S_COMPANYNO
		FROM SELLER
		WHERE S_NO=#{param1}
		
	</select>
	
	<!-- 페이징처리를 위해 보류 -->
	<select id="getReviewList" parameterType="int" resultType="com.koreait.baraON.dto.ReviewDto" >
		SELECT RV.RV_NO, RV.RV_STAR, RV.RV_IMG, M.M_NICK, M.M_ID
		FROM REVIEW RV LEFT JOIN MEMBER M ON RV.M_NO = M.M_NO AND RV.RV_DELETE = 0
		WHERE P_NO=#{param1}
		AND
	</select>
	
	<select id="getPlaceOptionList">
		SELECT *
		FROM PLACEOPTION
		WHERE P_NO=#{param1}
	</select>
	
	<select id="getPlaceDtoList">
		SELECT A.P_NO, A.RVCOUNT, PC.PC_NAME, MIN(PO.PO_DAYPRICE) AS MINPRICE, MAX(PO.PO_MAX) AS MAXPEOPLE, P2.P_TITLE, P2.P_IMG, P2.P_ADDR
		  FROM (SELECT P.P_NO, P.PC_NO, COUNT(RV.P_NO) AS RVCOUNT
				  FROM PLACE P LEFT JOIN REVIEW RV ON P.P_NO = RV.P_NO
				 WHERE P.P_CONFIRM = 1 
				   AND P.P_DELETE = 0
				   AND RV.RV_DELETE = 0
				   AND P.S_NO = #{param1}
			  GROUP BY P.P_NO, P.PC_NO) A LEFT JOIN PLACECATEGORY PC ON A.PC_NO = PC.PC_NO
										  LEFT JOIN PLACEOPTION PO ON A.P_NO = PO.P_NO
										  LEFT JOIN PLACE P2 ON A.P_NO = P2.P_NO
	  GROUP BY A.P_NO, A.PC_NO, A.RVCOUNT, PC.PC_NAME, P2.P_TITLE, P2.P_IMG, P2.P_ADDR
	  ORDER BY A.P_NO
	</select>
	
</mapper>